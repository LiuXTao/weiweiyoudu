import numpy as np
import datetime as dt


def rank(A, B, k, data):
    result=[]
    t1 = dt.datetime.now()
    S0 = 1
    for tmp in data:
        (id, datestap, reading, loving)=tmp
        t0 = dt.datetime.fromtimestamp(datestap)
        Z = A* reading + B* loving
        T = 0.6
        T = 1.2 * pow(0.75, (t1-t0).seconds/7200) if (t1 - t0).days == 0 and (t1 - t0).seconds < 28800 else T
        S1 = T * np.log(10*Z) if Z!=0 else 0
        S2 = ((t1 - t0).days/2+1)* np.exp(k*((t1-t0).seconds+(t1-t0).days*24*60*60)+1)
        ranking = (S0+S1)/(S2)
        print(id,'\t',t1-t0,'\t',(t1-t0).seconds+(t1-t0).days*24*60*60,'\t',S2,'\t',S1,'\t',ranking)
        result.append([id,ranking])
    return result

if __name__=='__main__':
    data = (
        (5, 1523777572, 8, 2), (6, 1523778743, 7, 2), (8, 1523842457, 1, 0), (10, 1523879651, 2, 0),
         (11, 1523879670, 0, 1), (12, 1523879736, 2, 2), (13, 1523879751, 3, 0), (14, 1523879767, 11, 0),
         (15, 1523879782, 5, 1), (16, 1523879794, 3, 0), (17, 1523879805, 4, 0), (18, 1523879822, 3, 0),
         (19, 1523879833, 0, 0), (20, 1523879857, 2, 0), (21, 1523879872, 0, 0), (22, 1523879885, 0, 0),
         (23, 1523879900, 1, 0), (24, 1523879919, 0, 0), (25, 1523879929, 1, 0), (26, 1523879940, 1, 0),
         (27, 1523879958, 1, 0), (28, 1523893973, 6, 0), (29, 1523894008, 6, 0), (101, 1523981262, 2, 0),
         (104, 1524049442, 0, 0), (105, 1524050466, 2, 0), (106, 1524133932, 2, 0), (107, 1524148598, 2, 0),
         (108, 1524184768, 4, 0), (109, 1524200694, 1, 0), (110, 1524204317, 3, 1), (111, 1524204516, 0, 0),
         (112, 1524208377, 0, 0), (113, 1524244941, 0, 0), (114, 1524368261, 0, 0), (115, 1524477858, 1, 0),(116,1524652783,0,0),
        (116, 1525370103,5, 1),(117, 1525390103, 200, 30),(118, 1525400103, 10, 2))
    #

    res = rank(2,6,0.000001,data)
    print(res)